#!/bin/bash
#==============================================================================
# Purpose : This Script will be used to set-up Environment Variables for SWAN
#==============================================================================
#                        MODIFICATIONS
#==============================================================================
# Date (YYYY-MM-DD)    Programmer Name     Change Description
# -----------------    -----------------   ------------------------------------
# 2016-02-12           Soumendra Mishra    Initial Creation
# 2016-07-19           Soumendra Mishra    Configuration for SWAN added
#==============================================================================

#==============================================================================
# Table info Properties
#==============================================================================
  export HDFS_TARGET_DIR="/EA/shared/misc"
  export TABLE_INFO_ID="${TBL_INFO_TABLE_INFO_ID}"
  export SOURCE_SYSTEM_NAME="${TBL_INFO_SOURCE_SYSTEM}"
  export DATA_LOAD_TYPE="${TBL_INFO_DATA_LOAD_TYPE}"
  export SOURCE_SCHEMA_NAME="${TBL_INFO_SOURCE_SCHEMA}"
  export SOURCE_TABLE_NAME="${TBL_INFO_SOURCE_TABLE}"
  export TARGET_TABLE_NAME="${TBL_INFO_TARGET_TABLE}"
  export PRIMARY_KEY="${TBL_INFO_PRIMARY_KEY}"
  export SQOOP_FILTER_MIN_TS="${TBL_INFO_MIN_TS}"
  export SQOOP_FILTER_MAX_TS="${TBL_INFO_MAX_TS}"
  export SQOOP_SPLIT_BY_FLAG="${TBL_INFO_SQOOP_SPLIT_BY_FLAG}"
  export SQOOP_SPLIT_BY_COL="${TBL_INFO_SQOOP_SPLIT_BY_COL}"
  export SQOOP_SPLIT_BY_LIMIT="${TBL_INFO_SQOOP_SPLIT_BY_LIMIT}"
  export HIVE_INCR_PRI_TABLE="${TBL_INFO_INCR_PRI_TABLE}"
  export HIVE_INCR_SEC_TABLE="${TBL_INFO_INCR_SEC_TABLE}"
  export MAP_COL_NULL="${TBL_INFO_MAP_COL_NULL}"

#==============================================================================
# Environment Variables for Job
#==============================================================================
  # Timestamp
  export JOB_TS="`date '+%Y%m%d%H%M%S'`"
  export EVENT_DT='date '+%Y-%m-%d''
  export EVENT_TM='date '+%H:%M:%S''

  # Job Step Info
  export JOB_MAX_STEPS=10

  # Log Info for Job
  export JOB_LOG_DIR="${JOB_HOME}/logs/${TARGET_TABLE_NAME}"

  # Table Info Log
  export TABLE_INFO_UPDATE_LOG="${JOB_LOG_DIR}/table_info_update_${JOB_TS}.log"

  # Event Logging & Auditing
  export EVENT_LOG_AUDIT_TABLE_NAME="event_log_audit"
  export EVENT_LOG_AUDIT_TABLE_LOG="${JOB_LOG_DIR}/event_log_audit_${JOB_TS}.log"

  # Service Account
  export SERVICE_ACCOUNT="srvc_ima_platform"

  #Hadoop Command
  export HADOOP_CMD="hadoop"

#==============================================================================
# Environment Variables for ehub
#==============================================================================
  # Sqoop Parameters (HDFS)
  export EHUB_HDFS_SYNC_DIR="${HDFS_TARGET_DIR}/process/incoming/${TARGET_TABLE_NAME}"

  # Source DB Info
  export EHUB_WEBHDFS_URL="webhdfs://g4t6526.houston.hp.com:14000/EDWExtractHub"

  # eHUB Script and Log Files
  export EHUB_LOG_DIR="${JOB_LOG_DIR}"
  export EHUB_LOG="${EHUB_LOG_DIR}/ehub_sync_${JOB_TS}.log"

#==============================================================================
# Environment Variables for Hive
#==============================================================================
  # Hive Table Info
  #export HIVE_DB_NAME="ea_fin"
export HIVE_DB_NAME="${TBL_INFO_HIVE_SCHEMA}" 
 export HIVE_FIELD_DELIMITER="\034"
  export HIVE_SERVER_URL="g4t8346c.houston.hp.com"
  export BEELINE="beeline -n srvc_ima_platform -u jdbc:hive2://${HIVE_SERVER_URL}:10000/ea_shared"

  # IFS Columns
  export IFS_FILE_NAME="TBD"
  export IFS_COL_KEY=" INS_GMT_TS, UPD_GMT_TS, SRC_SYS_EXTRC_GMT_TS, SRC_SYS_BTCH_NR, FILENM, LOAD_JOB_NR"
  export IFS_COL_VAL=" FROM_UNIXTIME(UNIX_TIMESTAMP()) AS INS_GMT_TS
                      ,FROM_UNIXTIME(UNIX_TIMESTAMP()) AS UPD_GMT_TS
                      ,FROM_UNIXTIME(UNIX_TIMESTAMP()) AS SRC_SYS_EXTRC_GMT_TS
                      ,0 AS SRC_SYS_BTCH_NR
                      ,'${IFS_FILE_NAME}' AS FILENM
                      ,0 AS LOAD_JOB_NR"

  # Hive Script and Log Files
  export HIVE_LOG_DIR="${JOB_LOG_DIR}"
  export HIVE_SCRIPT_DIR="${JOB_HOME}/scripts/workingcapital/hql/${TARGET_TABLE_NAME}"

  # Hive Raw Table (LZ)
  export HIVE_RAW_PARTITION_KEY="YEAR,MONTH"
  export HIVE_RAW_PARTITION_VAL="YEAR(FROM_UNIXTIME(UNIX_TIMESTAMP())), MONTH(FROM_UNIXTIME(UNIX_TIMESTAMP()))"

  export HIVE_RAW_TABLE_NAME="${TARGET_TABLE_NAME}_rw"
  export HIVE_RAW_EXT_TABLE_NAME="${TARGET_TABLE_NAME}_rw_ext"

  export HIVE_RAW_TABLE_LOG="${HIVE_LOG_DIR}/hive_raw_data_${JOB_TS}.log"
  export HIVE_RAW_EXT_TABLE_LOG="${HIVE_LOG_DIR}/hive_external_raw_data_${JOB_TS}.log"

  # Hive Refined Table (IC)
  export HIVE_REFINED_PARTITION_KEY="YEAR,MONTH"
  export HIVE_REFINED_PARTITION_VAL="YEAR(FROM_UNIXTIME(UNIX_TIMESTAMP())), MONTH(FROM_UNIXTIME(UNIX_TIMESTAMP()))"

  export HIVE_REFINED_TABLE_NAME="${TARGET_TABLE_NAME}"
  export HIVE_REFINED_EXT_TABLE_NAME="${TARGET_TABLE_NAME}_ext"

  export HIVE_REFINED_TABLE_LOG="${HIVE_LOG_DIR}/hive_refined_data_${JOB_TS}.log"
  export HIVE_REFINED_EXT_TABLE_LOG="${HIVE_LOG_DIR}/hive_external_refined_data_${JOB_TS}.log"
  export HIVE_REFINED_VIEW_LOG="${HIVE_LOG_DIR}/hive_create_view_${JOB_TS}.log"

  # Hive Refined Table Column List
  export HIVE_REFINED_TABLE_METADATA_FILE="${HDFS_TARGET_DIR}/process/metadata/wc_table_col.txt"

#==============================================================================
# Environment Variables for Pig
#==============================================================================
  # Pig Parameters (HDFS)
  export PIG_INCOMING_DIR="${HDFS_TARGET_DIR}/process/incoming/${TARGET_TABLE_NAME}"
  export PIG_RAW_STAGE_DIR="${HDFS_TARGET_DIR}/process/raw_stage/${TARGET_TABLE_NAME}"
  export PIG_REFINED_STAGE_DIR="${HDFS_TARGET_DIR}/process/refined_stage/${TARGET_TABLE_NAME}"

  # Pig Script and Log Files
  export PIG_LOG_DIR="${JOB_LOG_DIR}"
  export PIG_SCRIPT_RAW_DIR="${JOB_HOME}/scripts/workingcapital/pig/raw"
  export PIG_SCRIPT_REFINED_DIR="${JOB_HOME}/scripts/workingcapital/pig/refined"
  export PIG_SCRIPT_RAW_NAME="${PIG_SCRIPT_RAW_DIR}/${TARGET_TABLE_NAME}.pig"
  export PIG_SCRIPT_REFINED_NAME="${PIG_SCRIPT_REFINED_DIR}/${TARGET_TABLE_NAME}.pig"
  export PIG_SCRIPT_RAW_LOG="${PIG_LOG_DIR}/pig_raw_data_cleanse_${JOB_TS}.log"
  export PIG_SCRIPT_REFINED_LOG="${PIG_LOG_DIR}/pig_refined_data_cleanse_${JOB_TS}.log"



